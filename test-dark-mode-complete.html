<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Mode Complete Test</title>
    <link rel="stylesheet" href="/app/css/app-modern.css?v=3">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        .test-results {
            max-width: 1200px;
            margin: 100px auto 40px;
            padding: 20px;
        }
        .test-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        body.dark-mode .test-card {
            background: #1f2937;
            color: #e5e7eb;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 600;
            margin-left: 10px;
        }
        .status.pass {
            background: #d1fae5;
            color: #065f46;
        }
        .status.fail {
            background: #fee2e2;
            color: #991b1b;
        }
        body.dark-mode .status.pass {
            background: #065f46;
            color: #d1fae5;
        }
        body.dark-mode .status.fail {
            background: #991b1b;
            color: #fee2e2;
        }
        .color-sample {
            display: inline-block;
            width: 200px;
            height: 60px;
            border: 2px solid #ccc;
            margin: 10px;
            position: relative;
            vertical-align: top;
        }
        .color-label {
            position: absolute;
            bottom: 5px;
            left: 5px;
            background: rgba(255,255,255,0.9);
            padding: 2px 8px;
            font-size: 12px;
            font-family: monospace;
            border-radius: 4px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .metric {
            background: #f3f4f6;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }
        body.dark-mode .metric {
            background: #374151;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #00217d;
            margin-bottom: 4px;
        }
        body.dark-mode .metric-value {
            color: #60a5fa;
        }
        .metric-label {
            font-size: 14px;
            color: #6b7280;
        }
        #toggleBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #00217d;
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        #toggleBtn:hover {
            background: #001551;
        }
        body.dark-mode #toggleBtn {
            background: #ffc72c;
            color: #000;
        }
        body.dark-mode #toggleBtn:hover {
            background: #e6b400;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 16px;
            font-family: monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 10px 0;
        }
        body.dark-mode .code-block {
            background: #1f2937;
            border-color: #374151;
        }
    </style>
</head>
<body>
    <!-- Original App Header -->
    <header class="app-header">
        <div class="header-container">
            <div class="header-left">
                <div class="app-logo-container">
                    <img src="/app/images/pyebwa-logo.png" alt="Pyebwa" class="app-logo-img">
                </div>
                <nav class="nav-menu">
                    <button class="nav-item active">
                        <span class="material-icons">dashboard</span>
                        <span>Test Page</span>
                    </button>
                </nav>
            </div>
            <div class="header-right">
                <div class="language-selector">
                    <button class="lang-btn active">EN</button>
                    <button class="lang-btn">FR</button>
                    <button class="lang-btn">HT</button>
                </div>
            </div>
        </div>
    </header>

    <div class="test-results">
        <div class="test-card">
            <h2>Dark Mode Header Test Suite</h2>
            <p>This page comprehensively tests the dark mode header background color implementation.</p>
            
            <div class="test-grid">
                <div class="metric">
                    <div class="metric-value" id="cssVersion">-</div>
                    <div class="metric-label">CSS Version</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="darkModeStatus">OFF</div>
                    <div class="metric-label">Dark Mode</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="headerBgColor">-</div>
                    <div class="metric-label">Header Background</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="testsPassed">0/0</div>
                    <div class="metric-label">Tests Passed</div>
                </div>
            </div>
        </div>

        <div class="test-card">
            <h3>Visual Comparison</h3>
            <div style="text-align: center;">
                <div class="color-sample" style="background: #000;">
                    <span class="color-label">Target: #000 (Pure Black)</span>
                </div>
                <div class="color-sample" style="background: rgba(24, 24, 27, 0.95);">
                    <span class="color-label">Old: rgba(24, 24, 27, 0.95)</span>
                </div>
                <div class="color-sample" id="currentHeaderSample">
                    <span class="color-label" id="currentHeaderLabel">Current: Loading...</span>
                </div>
            </div>
        </div>

        <div class="test-card">
            <h3>Test Results <span id="overallStatus" class="status"></span></h3>
            <div id="testResults"></div>
        </div>

        <div class="test-card">
            <h3>CSS Rule Applied</h3>
            <div class="code-block">
body.dark-mode .app-header {
    background: #000 !important;
    background-color: #000 !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 1px 2px -1px rgba(0, 0, 0, 0.3);
}
            </div>
        </div>

        <div class="test-card">
            <h3>Browser Information</h3>
            <div id="browserInfo"></div>
        </div>
    </div>

    <button id="toggleBtn" onclick="toggleDarkMode()">
        <span class="material-icons" style="vertical-align: middle;">dark_mode</span>
        Toggle Dark Mode
    </button>

    <script>
        // Test suite
        const tests = [];
        let darkModeActive = false;

        function addTest(name, testFn) {
            tests.push({ name, testFn });
        }

        // Test 1: CSS File Loaded
        addTest('CSS file is loaded', () => {
            const link = document.querySelector('link[href*="app-modern.css"]');
            return {
                passed: !!link,
                details: link ? `Loaded: ${link.href}` : 'CSS file not found'
            };
        });

        // Test 2: Dark mode class toggle
        addTest('Dark mode class toggles correctly', () => {
            const hasClass = document.body.classList.contains('dark-mode');
            return {
                passed: hasClass === darkModeActive,
                details: `Expected: ${darkModeActive}, Actual: ${hasClass}`
            };
        });

        // Test 3: Header background color
        addTest('Header background is pure black in dark mode', () => {
            const header = document.querySelector('.app-header');
            const computed = window.getComputedStyle(header);
            const bg = computed.backgroundColor;
            
            if (!darkModeActive) {
                return {
                    passed: true,
                    details: 'Test only runs in dark mode'
                };
            }
            
            // Check if it's black (rgb(0, 0, 0))
            const isBlack = bg === 'rgb(0, 0, 0)' || bg === '#000' || bg === '#000000';
            
            return {
                passed: isBlack,
                details: `Background color: ${bg}`
            };
        });

        // Test 4: Important flag applied
        addTest('!important flag is respected', () => {
            if (!darkModeActive) {
                return {
                    passed: true,
                    details: 'Test only runs in dark mode'
                };
            }
            
            const header = document.querySelector('.app-header');
            const inlineStyle = header.style.background || header.style.backgroundColor;
            
            return {
                passed: !inlineStyle || inlineStyle === '',
                details: inlineStyle ? `Inline style found: ${inlineStyle}` : 'No inline styles (good)'
            };
        });

        // Test 5: Backdrop filter disabled
        addTest('Backdrop filter is disabled in dark mode', () => {
            if (!darkModeActive) {
                return {
                    passed: true,
                    details: 'Test only runs in dark mode'
                };
            }
            
            const header = document.querySelector('.app-header');
            const computed = window.getComputedStyle(header);
            const backdropFilter = computed.backdropFilter || computed.webkitBackdropFilter;
            
            const isDisabled = !backdropFilter || backdropFilter === 'none';
            
            return {
                passed: isDisabled,
                details: `Backdrop filter: ${backdropFilter || 'none'}`
            };
        });

        function runTests() {
            const results = document.getElementById('testResults');
            results.innerHTML = '';
            
            let passed = 0;
            let total = 0;
            
            tests.forEach(test => {
                const result = test.testFn();
                if (result.passed) passed++;
                total++;
                
                const div = document.createElement('div');
                div.style.marginBottom = '12px';
                div.innerHTML = `
                    <strong>${test.name}</strong>
                    <span class="status ${result.passed ? 'pass' : 'fail'}">${result.passed ? 'PASS' : 'FAIL'}</span>
                    <div style="color: #6b7280; font-size: 14px; margin-top: 4px;">${result.details}</div>
                `;
                results.appendChild(div);
            });
            
            // Update overall status
            document.getElementById('testsPassed').textContent = `${passed}/${total}`;
            const overallStatus = document.getElementById('overallStatus');
            overallStatus.textContent = passed === total ? 'ALL PASSED' : `${total - passed} FAILED`;
            overallStatus.className = `status ${passed === total ? 'pass' : 'fail'}`;
            
            // Update metrics
            updateMetrics();
        }

        function updateMetrics() {
            // CSS Version
            const cssLink = document.querySelector('link[href*="app-modern.css"]');
            const version = cssLink ? (cssLink.href.match(/v=(\d+)/) || ['', 'none'])[1] : 'not found';
            document.getElementById('cssVersion').textContent = version;
            
            // Dark mode status
            document.getElementById('darkModeStatus').textContent = darkModeActive ? 'ON' : 'OFF';
            
            // Header background
            const header = document.querySelector('.app-header');
            const bg = window.getComputedStyle(header).backgroundColor;
            document.getElementById('headerBgColor').textContent = bg;
            
            // Update color sample
            const sample = document.getElementById('currentHeaderSample');
            sample.style.background = bg;
            document.getElementById('currentHeaderLabel').textContent = `Current: ${bg}`;
        }

        function toggleDarkMode() {
            darkModeActive = !darkModeActive;
            document.body.classList.toggle('dark-mode', darkModeActive);
            
            // Store preference
            if (typeof storeUserPreference === 'function') {
                storeUserPreference('theme', darkModeActive ? 'dark' : 'light');
            }
            
            // Run tests after a brief delay to ensure styles are applied
            setTimeout(runTests, 100);
        }

        function showBrowserInfo() {
            const info = document.getElementById('browserInfo');
            const ua = navigator.userAgent;
            
            info.innerHTML = `
                <div><strong>User Agent:</strong> ${ua}</div>
                <div><strong>Browser:</strong> ${getBrowserName()}</div>
                <div><strong>Viewport:</strong> ${window.innerWidth} x ${window.innerHeight}</div>
                <div><strong>Device Pixel Ratio:</strong> ${window.devicePixelRatio || 1}</div>
            `;
        }

        function getBrowserName() {
            const ua = navigator.userAgent;
            if (ua.includes('Chrome')) return 'Chrome';
            if (ua.includes('Firefox')) return 'Firefox';
            if (ua.includes('Safari') && !ua.includes('Chrome')) return 'Safari';
            if (ua.includes('Edge')) return 'Edge';
            return 'Unknown';
        }

        // Initialize
        window.addEventListener('load', () => {
            showBrowserInfo();
            
            // Check for stored theme preference
            const storedTheme = localStorage.getItem('pyebwaTheme');
            if (storedTheme === 'dark') {
                darkModeActive = true;
                document.body.classList.add('dark-mode');
            }
            
            // Run tests
            runTests();
            
            // Re-run tests when CSS loads/changes
            const observer = new MutationObserver(() => {
                setTimeout(runTests, 100);
            });
            observer.observe(document.head, { childList: true, subtree: true });
        });
    </script>
</body>
</html>