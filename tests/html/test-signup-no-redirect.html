<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Signup No Redirect</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .status {
            padding: 20px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
        }
        button:hover {
            background-color: #0056b3;
        }
        .log-entry {
            padding: 5px;
            margin: 5px 0;
            background-color: #f0f0f0;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Test Signup Page - No Redirect</h1>
    
    <div id="status" class="status">Checking signup page behavior...</div>
    
    <div>
        <button onclick="testSignupPage()">Test Signup Page</button>
        <button onclick="clearAllFlags()">Clear All Flags</button>
        <button onclick="checkFlags()">Check Flags</button>
    </div>
    
    <h2>Test Log:</h2>
    <div id="log"></div>
    
    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            entry.style.color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            logDiv.appendChild(entry);
            console.log(message);
        }
        
        function updateStatus(message, type = 'success') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
        }
        
        function checkFlags() {
            log('Checking flags...');
            log('window.preventRedirect: ' + window.preventRedirect);
            log('window.isSignupPage: ' + window.isSignupPage);
            log('sessionStorage.onSignupPage: ' + sessionStorage.getItem('onSignupPage'));
            log('sessionStorage.preventRedirect: ' + sessionStorage.getItem('preventRedirect'));
            log('localStorage.currentPage: ' + localStorage.getItem('currentPage'));
        }
        
        function clearAllFlags() {
            log('Clearing all flags...');
            delete window.preventRedirect;
            delete window.isSignupPage;
            sessionStorage.removeItem('onSignupPage');
            sessionStorage.removeItem('preventRedirect');
            localStorage.removeItem('currentPage');
            log('All flags cleared', 'success');
            checkFlags();
        }
        
        async function testSignupPage() {
            log('Starting signup page test...');
            updateStatus('Testing signup page...', 'info');
            
            // Clear flags first
            clearAllFlags();
            
            // Open signup page in iframe to monitor behavior
            log('Creating iframe for signup.html...');
            const iframe = document.createElement('iframe');
            iframe.style.width = '100%';
            iframe.style.height = '600px';
            iframe.style.border = '2px solid #ccc';
            iframe.style.marginTop = '20px';
            
            // Monitor for navigation
            let redirectDetected = false;
            iframe.onload = function() {
                try {
                    const iframeUrl = iframe.contentWindow.location.href;
                    log('Iframe loaded: ' + iframeUrl);
                    
                    if (iframeUrl.includes('login.html')) {
                        redirectDetected = true;
                        updateStatus('ERROR: Signup page redirected to login.html!', 'error');
                        log('Redirect detected to: ' + iframeUrl, 'error');
                    } else if (iframeUrl.includes('signup.html')) {
                        updateStatus('SUCCESS: Signup page loaded without redirect!', 'success');
                        log('Signup page loaded successfully', 'success');
                        
                        // Check console logs from iframe
                        if (iframe.contentWindow && iframe.contentWindow.console) {
                            log('Checking iframe console for blocked redirects...');
                        }
                    }
                } catch (e) {
                    log('Cannot access iframe URL (cross-origin): ' + e.message);
                }
            };
            
            document.body.appendChild(iframe);
            iframe.src = '/signup.html';
            
            // Also test direct navigation
            setTimeout(() => {
                if (!redirectDetected) {
                    log('Opening signup.html in new tab for manual verification...');
                    window.open('/signup.html', '_blank');
                }
            }, 2000);
        }
        
        // Run initial check
        checkFlags();
        log('Test page ready');
    </script>
</body>
</html>